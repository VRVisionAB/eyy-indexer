/**
 * <gallery-mode-plugin>
 * 
 * A plugin for <eyy-indexer> [https://github.com/sixem/eyy-indexer]
 * 
 * Licensed under GPL-3.0
 * @author   emy [admin@eyy.co]
 * @version  0.2 (1.1.4)
 */

"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(e){e.fn.gallery=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i={data:{busy:!1,scrollbreak:!1,isChrome:/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}};i.settings=e.extend({extensions:{image:["jpg","jpeg","gif","png","ico","svg","bmp"],video:["mp4","webm"]},console:!0,blur:!0,filter:!0,start:0,fade:0,mobile:!1,scroll_interval:35,reverse_options:!0},i.settings,n),i.loadImage=function(e){return new Promise(function(t,n){var i=new Image;i.addEventListener("load",function(n){return t(e)}),i.addEventListener("error",function(){n(new Error("failed to load image URL: ".concat(e)))}),i.src=e})},i.getExtension=function(e){return e.split(".").pop().toLowerCase()},i.getObjectSet=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e(n.filter(function(e){return void 0!==e}).map(function(t){return e(t)}))},i.filterItems=function(e){return e.filter(function(e,t){return i.isImage(e.name)||i.isVideo(e.name)})},i.isImage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i.settings.extensions.image.includes(t||i.getExtension(e))},i.isVideo=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i.settings.extensions.video.includes(t||i.getExtension(e))},i.getScrollBarWidth=function(){if(e("body").height()<e(window).height())return 0;var t=e("<div>").css({visibility:"hidden",width:100,overflow:"scroll"}).appendTo("body"),n=e("<div>").css({width:"100%"}).appendTo(t).outerWidth();return t.remove(),100-n},i.limitBody=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=e("body"),r=i.getScrollBarWidth();!0===t?(i.data.body={"max-height":n.css("max-height"),width:n.css("width"),overflow:n.css("overflow")},r>0&&n.find("> table").css({width:i.data.isChrome?"100%":"calc(100% - "+r+"px)","padding-right":r+"px"}),n.css({"max-height":"calc(100vh - var(--gallery-top-bar-height))",overflow:"hidden"})):(i.data.hasOwnProperty("body")&&n.css({"max-height":i.data.body["max-height"],width:"unset",overflow:i.data.body.overflow}),n.find("> table").css({width:"100%","padding-right":"unset"}))},i.exists=function(){return i.container=e("div.gallery-container"),i.container.length>0},i.show=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n&&(i.settings.console&&console.log("itemsUpdate",!0),i.data.selected.index=null,i.items=i.settings.filter?i.filterItems(n):n,i.populateTable(i.items)),!0===e?(i.bind().show(),t!==i.data.selected.index&&(i.container.find(".media .wrapper img, .media .wrapper video").hide(),i.navigate(t)),i.container.find(".list").scrollTo(i.container.find("> .list").find("tr").eq(t))):(i.unbind(i.data.bound),i.container.hide()),i.settings.blur&&(i.setBlur(e),i.limitBody(e));var r=i.container.find(".media .wrapper video");r.length>0&&(!0===e&&r.is(":visible")?(r[0].currentTime=0,r[0].muted=!1,r[0].play()):!1===e&&(r[0].muted=!0,r[0].pause()))},i.data.busy=null,i.data.busy_handle=null,i.tick=function(e){var t=parseInt(e.attr("data-tick"));return e.text("Loading "+".".repeat(t)).attr("data-tick",t>=3?1:t+1),e},i.busy=function(t){if(void 0!==t){i.data.busy=t;var n=i.container.find(".media .loader");e(n)[0].hasAttribute("data-tick")||e(n).attr("data-tick",1),t?(n.is(":hidden")&&n.stop().fadeIn(400),i.data.busy_handle=setInterval(function(){return i.tick(n)},225)):(n.is(":visible")&&n.stop().fadeOut(200,function(){return n.attr("data-tick",1).text("Loading .")}),i.data.busy||clearInterval(i.data.busy_handle))}return i.data.busy},i.populateTable=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===t&&(t=i.container.find(".list table")),t.html(""),e.forEach(function(e){return t.append('<tr title="'.concat(e.name,'"><td>').concat(e.name,"</td></tr>"))}),t},i.hideExisting=function(e){var t=i.container.find(e).hide();return t.length>0?t:null},i.setBlur=function(){return!0===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?i.data.blurred=e("body > *:not(.gallery-container):not(script):not(noscript):not(style)").addClass("blur"):i.data.hasOwnProperty("blurred")&&i.data.blurred.removeClass("blur"),i},i.getReverseOptions=function(e){return{Google:"https://www.google.com/searchbyimage?image_url="+(e=encodeURIComponent(document.location.origin+e))+"&safe=off",Yandex:"https://www.yandex.com/images/search?rpt=imageview&img_url="+e,IQDB:"https://iqdb.org/?url="+e}},i.reverse=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!i.settings.reverse_options)return!1;if(0===i.container.find(".content-container .media .wrapper .cover").length)return!1;var o=i.container.find(".content-container .media .reverse");if(0===o.length&&(o=e("<div/>",{class:"reverse"}).appendTo(i.container.find(".content-container .media .wrapper .cover"))),!1!==n){var a=i.getReverseOptions(i.data.selected.src);o.html(Object.keys(a).map(function(e){return'<a class="reverse-link" target="_blank" href="'.concat(a[e],'">').concat(e,"</a>")}).join("|")),o.is(":hidden")&&o.show()}else r>0?o.stop().fadeOut(r):o.hide()},i.shortenString=function(e,t){return t=t||28,e.length>t?[e.substr(0,Math.floor(t/2-2)),e.substr(e.length-Math.floor(t/2-2),e.length)].join(" .. "):e},i.setItemInfo=function(e,t,n){i.settings.console&&console.log("itemSet",e);var r=i.settings.mobile?i.shortenString(e.name,30):e.name;i.container.find(".bar > .right > a.download").attr("filename",e.name).attr("href",e.url).attr("title","Download: ".concat(e.name)),i.container.find(".bar > .left").html("<span>".concat(t+1," of ").concat(n,"</span>")+' | <a href="'.concat(e.url,'">').concat(r,"</a>")+(e.hasOwnProperty("size")&&!i.settings.mobile?" | <span>".concat(e.size,"</span>"):""))},i.isScrolledIntoView=function(t,n){var i=t.offset().top-e(window).scrollTop();return!(i<n)&&!(i+t.outerHeight()>e(window).height())},i.scrollIntoView=function(e,t){t.stop().animate({scrollTop:e.offset().top-t.offset().top},0)},i.calculateIndex=function(e,t,n){var r=e+t;return r>n&&(r=r-n-1),r<0&&(r=n-(Math.abs(r)-1)),r<0||r>n?i.calculateIndex(e,n-r,n):r},i.createVideo=function(t){var n=e("<video/>",{controls:"",autoplay:"",loop:""});return[n,e("<source>",{type:"video/"+t,src:""}).appendTo(n)]},i.showItem=function(e,t,n,r,o){var a,s,l;a=i.container.find(".media .wrapper");var d=function(){if(i.container.find(".content-container .media .reverse"),0===e)t.show().attr("src",n),(s=i.container.find(".media .wrapper video")).length>0&&(s[0].pause(),s.find("source").attr("src",""));else if(1===e){if(!1!==r||i.data.isChrome)l=t.find("source"),s=t;else{t.remove();var d=_slicedToArray(i.createVideo(i.data.selected.ext),2);s=d[0],l=d[1],s.appendTo(a)}l.attr("src",n),s[0].load(),s[0].addEventListener("loadeddata",function(){s.show()},!1)}i.container.find(".media .wrapper ".concat(0===e?"video":"img")).hide(),i.settings.fade>0?a.stop().fadeIn(i.settings.fade):a.show(),i.data.selected.index=o};i.settings.fade>0?a.stop().fadeOut(i.settings.fade,function(){d()}):d(),i.busy(!1)},i.navigate=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(i.settings.console&&console.log("busyState",i.busy()),i.busy())return!1;var r=i.items.length-1;if(null===t&&(t=i.data.selected.index),null!==n&&(t=i.calculateIndex(t,n,r)),i.data.selected.index!==t&&!0!==i.busy()){var o=i.items[t];i.setItemInfo(o,t,r+1),i.data.selected.src=o.url,i.data.selected.ext=i.getExtension(o.name);var a,s,l,d=i.container.find(".list"),c=d.find("table"),u=c.find("tr").eq(t);if(c.find("tr.selected").removeAttr("class"),u.attr("class","selected"),i.isScrolledIntoView(u,Math.floor(i.container.find(".bar").outerHeight()-4))||d.scrollTo(u),i.isImage(null,i.data.selected.ext)){if(i.busy(!0),s=i.container.find(".media .wrapper img"),a=i.container.find(".media .wrapper video"),l=0===s.length,a.length>0&&a[0].pause(),!0===l){var f=e("<div/>",{class:"cover"}).prependTo(i.container.find(".media .wrapper"));s=e("<img>").prependTo(f)}return i.loadImage(o.url).then(function(e){i.data.selected.src===e&&i.showItem(0,s,e,l,t)}).catch(function(e){i.busy(!1),console.error(e)}),!0}if(i.isVideo(null,i.data.selected.ext)){if(i.busy(!0),a=i.container.find(".media .wrapper video"),l=0===a.length){var p=_slicedToArray(i.createVideo(i.data.selected.ext),2);a=p[0],p[1],a.appendTo(i.container.find(".media .wrapper"))}return i.showItem(1,a,o.url,l,t),!0}}},i.data.key_prevent=[33,34,37,38,39,40,71],i.handleKey=function(e,t){i.settings.console&&console.log("handleKey",e),27===e?i.show(!1):40===e||34===e||39===e?i.navigate(null,1):38!==e&&33!==e&&37!==e||i.navigate(null,-1),t(i.data.key_prevent.includes(e))},i.unbind=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.forEach(function(t){if(t.hasOwnProperty("direct")&&!0===t.direct)return e(t.trigger).off(t.event),!0;t.trigger?e(document).off(t.event,t.trigger):e(document).off(t.event)}),!0===n&&e(i).trigger("unbound",!0)},i.scrollBreak=function(){i.data.scrollbreak=!1},i.bind=function(){return i.data.bound=[{event:"click",trigger:"div.gallery-container .list table tr"},{event:"click",trigger:'div.gallery-container [data-action="close"]'},{event:"click",trigger:'div.gallery-container [data-action="toggle"]'},{event:"click",trigger:'div.gallery-container [data-action="previous"]'},{event:"click",trigger:'div.gallery-container [data-action="next"]'},{event:"click",trigger:"div.gallery-container .media"},{event:"DOMMouseScroll mousewheel",trigger:"div.gallery-container .media"},{event:"mouseover",trigger:"div.gallery-container .media .wrapper img"},{event:"mouseleave",trigger:"div.gallery-container .media .wrapper img"},{event:"mouseleave",trigger:"div.gallery-container .media .reverse a"},{event:"swipeleft",trigger:"div.gallery-container",direct:!0},{event:"swiperight",trigger:"div.gallery-container",direct:!0},{event:"keydown",trigger:null},{event:"keyup",trigger:null}],i.unbind(i.data.bound,!1),e(document).on("click",'div.gallery-container [data-action="close"]',function(e){i.show(!1)}),e(document).on("click",'div.gallery-container [data-action="toggle"]',function(t){var n=i.container.find(".list");n.is(":visible")?(n.css("display","none"),e(t.currentTarget).text("List+")):(n.css("display","table-cell"),e(t.currentTarget).text("List-"))}),e(document).on("click",'div.gallery-container [data-action="previous"]',function(e){i.navigate(null,-1)}),e(document).on("click",'div.gallery-container [data-action="next"]',function(e){i.navigate(null,1)}),e(document).on("click","div.gallery-container .list table tr",function(t){i.navigate(e(t.currentTarget).index())}),e(document).on("click","div.gallery-container .media",function(t){e(t.target).is("img, video, a")||i.show(!1)}),!0===i.settings.reverse_options&&e(document).on("mouseenter","div.gallery-container .media .wrapper .cover",function(t){i.reverse(e(t.currentTarget),!0)}),e(document).on("mouseleave","div.gallery-container .media .wrapper .cover",function(t){i.reverse(e(t.currentTarget),!1)}),!0===i.settings.mobile&&(e("div.gallery-container").on("swipeleft",function(e,t){return i.navigate(null,1)}),e("div.gallery-container").on("swiperight",function(e,t){return i.navigate(null,-1)})),e(document).on("DOMMouseScroll mousewheel","div.gallery-container .media",function(e){if(i.settings.scroll_interval>0&&!0===i.data.scrollbreak)return!1;i.navigate(null,e.originalEvent.detail>0||e.originalEvent.wheelDelta<0?1:-1),i.settings.scroll_interval>0&&(i.data.scrollbreak=!0,setTimeout(function(){return i.scrollBreak()},i.settings.scroll_interval))}),e(document).on("keydown",e.fn,function(e){i.data.key_prevent.includes(e.keyCode)&&e.preventDefault(),71===e.keyCode&&i.show(!1)}),e(document).on("keyup",e.fn,function(e){i.handleKey(e.keyCode,function(t){t&&e.preventDefault()})}),e(i).trigger("bound",!0),i.container},i.barConstruct=function(t){e("<a/>",{text:i.settings.mobile?"Save":"Download",class:"download",download:""}).appendTo(t),i.settings.mobile||e("<span/>",{"data-action":"previous",text:"Previous"}).appendTo(t),i.settings.mobile||e("<span/>",{"data-action":"next",text:"Next"}).appendTo(t),i.settings.mobile||e("<span/>",{"data-action":"toggle",text:"List-"}).appendTo(t),e("<span/>",{"data-action":"close",text:"Close"}).appendTo(t)};return i.container=e("div.gallery-container"),i.items=i.settings.filter?i.filterItems(t):t,0!==i.items.length&&(i.data.selected={src:null,ext:null,index:null,type:null},i.exists()?i.show(!0):function(t){i.limitBody(!0);var n=e("body").find("#image-preview, #video-preview");n.length>0&&n.remove(),i.container=e("<div/>",{class:"gallery-container"}).prependTo("body");var r=e("<div/>",{class:"bar"}).appendTo(i.container);e("<div/>",{class:"left"}).appendTo(r),i.barConstruct(e("<div/>",{class:"right"}).appendTo(r));var o=e("<div/>",{class:"content-container"}).appendTo(i.container),a=e("<div/>",{class:"media"}).appendTo(o),s=e("<div/>",{class:"list"}).appendTo(o);!0===i.settings.mobile&&(s.hide(),e("<span/>",{text:"<"}).appendTo(e("<div/>",{class:"screen-nav left","data-action":"previous"}).appendTo(o)),e("<span/>",{text:">"}).appendTo(e("<div/>",{class:"screen-nav right","data-action":"next"}).appendTo(o))),a.append('<div class="wrapper"></div>').append('<div class="loader">Loading ..</div>'),e("<tbody/>").appendTo(e("<table/>",{cellspacing:"0"}).appendTo(s)),i.populateTable(i.items),t(!0)}(function(){i.settings.blur&&i.setBlur(!0).bind()}),i.navigate(i.settings.start>i.items.length-1?i.items.length-1:i.settings.start),i)}}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){function t(t){return!t.nodeName||-1!==e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"])}function n(t){return e.isFunction(t)||e.isPlainObject(t)?t:{top:t,left:t}}var i=e.scrollTo=function(t,n,i){return e(window).scrollTo(t,n,i)};return i.defaults={axis:"xy",duration:0,limit:!0},e.fn.scrollTo=function(r,o,a){"object"===_typeof(o)&&(a=o,o=0),"function"==typeof a&&(a={onAfter:a}),"max"===r&&(r=9e9),a=e.extend({},i.defaults,a),o=o||a.duration;var s=a.queue&&1<a.axis.length;return s&&(o/=2),a.offset=n(a.offset),a.over=n(a.over),this.each(function(){function l(t){var n=e.extend({},a,{queue:!0,duration:o,complete:t&&function(){t.call(u,p,a)}});f.animate(g,n)}if(null!==r){var d,c=t(this),u=c?this.contentWindow||window:this,f=e(u),p=r,g={};switch(_typeof(p)){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(p)){p=n(p);break}p=c?e(p):e(p,u);case"object":if(0===p.length)return;(p.is||p.style)&&(d=(p=e(p)).offset())}var v=e.isFunction(a.offset)&&a.offset(u,p)||a.offset;e.each(a.axis.split(""),function(e,t){var n="x"===t?"Left":"Top",r=n.toLowerCase(),o="scroll"+n,h=f[o](),m=i.max(u,t);d?(g[o]=d[r]+(c?0:h-f.offset()[r]),a.margin&&(g[o]-=parseInt(p.css("margin"+n),10)||0,g[o]-=parseInt(p.css("border"+n+"Width"),10)||0),g[o]+=v[r]||0,a.over[r]&&(g[o]+=p["x"===t?"width":"height"]()*a.over[r])):(n=p[r],g[o]=n.slice&&"%"===n.slice(-1)?parseFloat(n)/100*m:n),a.limit&&/^\d+$/.test(g[o])&&(g[o]=0>=g[o]?0:Math.min(g[o],m)),!e&&1<a.axis.length&&(h===g[o]?g={}:s&&(l(a.onAfterFirst),g={}))}),l(a.onAfter)}})},i.max=function(n,i){var r="scroll"+(o="x"===i?"Width":"Height");if(!t(n))return n[r]-e(n)[o.toLowerCase()]();var o="client"+o,a=(s=n.ownerDocument||n.document).documentElement,s=s.body;return Math.max(a[r],s[r])-Math.min(a[o],s[o])},e.Tween.propHooks.scrollLeft=e.Tween.propHooks.scrollTop={get:function(t){return e(t.elem)[t.prop]()},set:function(t){var n=this.get(t);if(t.options.interrupt&&t._last&&t._last!==n)return e(t.elem).stop();var i=Math.round(t.now);n!==i&&(e(t.elem)[t.prop](i),t._last=this.get(t))}},i}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e(require("jquery")):e(jQuery)}(function(e){e.detectSwipe={version:"2.1.2",enabled:"ontouchstart"in document.documentElement,preventDefault:!0,threshold:125};var t,n,i=!1;function r(){this.removeEventListener("touchmove",o),this.removeEventListener("touchend",r),i=!1}function o(o){if(e.detectSwipe.preventDefault&&o.preventDefault(),i){var a,s=o.touches[0].pageX,l=o.touches[0].pageY,d=t-s,c=n-l,u=window.devicePixelRatio||1;Math.abs(d)*u>=e.detectSwipe.threshold?a=d>0?"left":"right":Math.abs(c)*u>=e.detectSwipe.threshold&&(a=c>0?"up":"down"),a&&(r.call(this),e(this).trigger("swipe",a).trigger("swipe"+a))}}function a(e){1==e.touches.length&&(t=e.touches[0].pageX,n=e.touches[0].pageY,i=!0,this.addEventListener("touchmove",o,!1),this.addEventListener("touchend",r,!1))}e.event.special.swipe={setup:function(){this.addEventListener&&this.addEventListener("touchstart",a,!1)}},e.each(["left","up","down","right"],function(){e.event.special["swipe"+this]={setup:function(){e(this).on("swipe",e.noop)}}})});