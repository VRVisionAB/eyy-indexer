/**
 * <image-preview-js> [https://github.com/sixem/image.preview.js]
 *
 * Licensed under MIT
 * @author  emy [admin@eyy.co]
 * @version 0.3
 */

"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){t.fn.imagePreview=function(e){var i={loading:null,store:{},last:{},css:{required:{}}};i.settings=t.extend({hoverDelay:75,staticPreview:!1,windowMargin:4,triggerMargin:24,elements:[],extensions:{images:["jpg","jpeg","gif","png","ico","svg","bmp"],videos:["mp4","webm"]}},i.settings,e),i.css.required={"max-height":"calc(100% - "+2*i.settings.windowMargin+"px)",visibility:"hidden",position:"fixed",top:i.settings.windowMargin,left:0,"z-index":99999,"pointer-events":"none"},i.refreshSettings=function(){i.css.required["max-height"]="calc(100% - "+2*i.settings.windowMargin+"px)",i.css.required.top=i.settings.windowMargin},i.isStatic=function(){return!(!i.settings.staticPreview&&null!=i.settings.mouse)},i.arrayContains=function(e,i){return t.inArray(e,i)>-1};var r=function(){if(null==i.current)return!1;var e,r,n;if(i.windowScrollTop=t(window).scrollTop(),i.windowScrollLeft=t(window).scrollLeft(),i.isStatic()?null==i.store.offset&&(i.store.offset=(e=i.last.trigger,{top:(r=e.offset()).top-i.windowScrollTop,left:r.left-i.windowScrollLeft,offset:r,margin:e.width()+i.settings.triggerMargin})):null==i.store.offset?i.store.offset={top:i.settings.mouse.pageY-i.windowScrollTop,left:i.settings.mouse.pageX-i.windowScrollLeft,margin:i.settings.triggerMargin}:i.store.offset.left=i.settings.mouse.pageX-i.windowScrollLeft,i.windowWidthH>i.windowWidth-i.store.offset.left?(n=Math.floor(i.windowWidth-i.store.offset.left+i.settings.triggerMargin),i.current.css({left:"",right:n+"px","max-width":i.windowWidth-n-i.settings.windowMargin+"px"})):(n=Math.floor(i.store.offset.left+i.store.offset.margin),i.current.css({left:n+"px",right:"","max-width":i.windowWidth-n-i.settings.windowMargin+"px"})),null==i.store.currentTop){var o=i.windowHeight-2*i.settings.windowMargin;i.store.adjustedHeight=i.current.height(),i.store.adjustedHeight<o&&(i.store.currentTop=function(t,e){var r=e/t*100,n=t/100*(r=r>100?100:r)-i.store.adjustedHeight/100*r;return i.current.css("max-height",t-(t-i.store.adjustedHeight)+"px"),n<i.settings.windowMargin?i.settings.windowMargin:n}(o,i.store.offset.top),i.current.css("top",i.store.currentTop+"px"))}i.current.css("visibility","visible"),i.visible=!0},n=function(e){if(!1===e){var r=t("body").find("#video-preview, #image-preview");return r.length>0&&r.remove(),i.visible=!1,i.current=i.last.src=void 0,i.store={adjustedHeight:0,currentHeight:0,currentWidth:0,currentTop:void 0},!1}var n,o;if(!1!==(n=i.last.trigger.data("preview"))&&void 0!==n?i.last.src=i.last.trigger.data("preview"):"undefined"!==_typeof(o=i.last.trigger.attr(i.last.trigger.is("img")?"src":"href"))&&!1!==o&&(i.last.src=o),null==i.last.src)return!1;if(i.last.ext=i.last.src.split(".").pop().toLowerCase(),i.arrayContains(i.last.ext,i.settings.extensions.images)){null===i.loading&&(t(i).trigger("loadChange",!0),i.loading=!0);var s=new Image;s.orig=i.last.src,t(s).on("load",function(e){if(!i.visible){if(e.currentTarget.orig==i.last.src){var r=t("<img>",{id:"image-preview",src:s.src}).prependTo(t("body"));i.current=r,i.current.on("load",function(){i.getDimensions()}),i.current.css(i.css.required),void 0!==i.settings.css&&i.current.css(i.settings.css),null!==i.loading&&(t(i).trigger("loadChange",!1),i.loading=null),t(i).trigger("loaded",{itemType:0,element:r,source:e.currentTarget.orig,dimensions:{width:e.currentTarget.width,height:e.currentTarget.height}})}return!0}}),s.src=i.last.src}if(i.arrayContains(i.last.ext,i.settings.extensions.videos)){null===i.loading&&(t(i).trigger("loadChange",!0),i.loading=!0);var g=t("<video/>",{id:"video-preview",loop:"",muted:"",autoplay:""}).prependTo(t("body")),a=t("<source>",{src:""}).prependTo(g);i.current=g,g.attr("data-orig",i.last.src),a.attr("src",i.last.src),g.css(i.css.required),void 0!==i.settings.css&&g.css(i.settings.css),g[0].muted=!0,g[0].load(),i.waitForVideo(g)}};i.waitForVideo=function(e){!function n(){return null!=i.current&&e.data("orig")===i.last.src&&(e.prop("readyState")>=3&&e.width()>0&&e.height()>0?(i.currentWidth=e.width(),i.store.currentHeight=e.height(),r(i.isStatic()),e[0].play(),t(i).trigger("loadChange",!1),null!==i.loading&&(t(i).trigger("loadChange",!1),i.loading=null),t(i).trigger("loaded",{itemType:1,element:e,source:e.data("orig"),dimensions:{width:e.width(),height:e.height()}}),!0):void setTimeout(n,150))}()},i.getDimensions=function(){!function t(){return null!=i.current&&(i.current.width()>0&&i.current.height()>0?(i.currentWidth=i.current.width(),i.store.currentHeight=i.current.height(),r(i.isStatic()),!0):void setTimeout(t,150))}()};var o=function(){i.windowWidth=t(window).width(),i.windowHeight=t(window).height(),i.windowWidthH=t(window).width()/2};return function(){if(i.settings.elements.length<1)return!1;o(),t.each(i.settings.elements,function(e,s){t(document).off("mouseenter",s).on("mouseenter",s,function(e){i.last.trigger=t(e.currentTarget),i.timer=setTimeout(function(){if(i.visible)return!0;n()},i.settings.hoverDelay)}),t(document).off("mouseleave",s).on("mouseleave",s,function(e){null!==i.loading&&(t(i).trigger("loadChange",!1),i.loading=null),clearTimeout(i.timer),n(!1)}),t(window).off("resize").on("resize",function(){void 0!==i.resizeTimer&&clearTimeout(i.resizeTimer),i.resizeTimer=setTimeout(function(){o()},250)}),i.settings.staticPreview||t(document).off("mousemove",s).on("mousemove",s,function(t){i.settings.mouse=t,i.visible&&r()})})}(),i}}(jQuery);