/**
 * <eyy-indexer-main> [https://github.com/sixem/eyy-indexer]
 * 
 * Licensed under GPL-3.0
 * @author   emy [admin@eyy.co]
 * @version  1.1.4
 */

"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(i=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var lister={selection:{},selected:null,gallery:null,refresh:!1,defaults:{}};$(document).on("click","body > .top-bar > div.extend",function(e){toggleMenu()}),$(document).on("click",".filter-container > div.close > span",function(e){toggleFilter()}),$(document).on("input",'.filter-container > div input[type="text"]',function(e){applyFilter($(e.currentTarget).val())}),$(document).on("click","body > div.menu #filter",function(e){toggleFilter(),toggleMenu()});var fallbackCopyTextToClipboard=function(e){var t=document.createElement("textarea");t.value=e,t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{var n=document.execCommand("copy");config.debug&&console.log("fallback","copying text command was "+(n?"successful":"unsuccessful"))}catch(e){config.debug&&console.error("fallback","unable to copy",e)}document.body.removeChild(t)},copyTextToClipboard=function(e){navigator.clipboard?navigator.clipboard.writeText(e).then(function(){config.debug&&console.log("async","copying to clipboard was successful.")},function(e){config.debug&&console.error("async","could not copy text: ",e)}):fallbackCopyTextToClipboard(e)},getReadableSize=function(e){if(0===e)return"0.00 B";var t=-1;do{e/=1024,t++}while(e>1024);return Math.max(e,.1).toFixed(1)+[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"][t]},getCellValue=function(e,t){var n=$(e).children("td").eq(t).data("raw");return void 0!==n?n:$(e).children("td").eq(t).text()},comparer=function(e){return function(t,n){var i=getCellValue(t,e),r=getCellValue(n,e);return $.isNumeric(i)&&$.isNumeric(r)?i-r:i.localeCompare(r)}},getTableItems=function(){var e=[];return $("tr.file td:first-child a.preview").each(function(t,n){var i=(n=$(n)).closest("tr");if(i.is(":hidden"))return!0;var r=n.attr("href"),o=n.closest("td").data("raw"),a=i.find("td").eq(2).text();void 0!==r&&void 0!==o&&e.push({name:o,url:r,size:a})}),e},toggleMenu=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=$("body > div.menu");return t.css("display",!0===e||!1===e?e?"inline-block":"none":t.is(":hidden")?"inline-block":"none"),$("body > .top-bar > div.extend").html(t.is(":hidden")?"+":"-"),t.is(":hidden")};!0===config.gallery.enabled&&($(document).on("click","body > div.menu #gallery",function(e){loadGallery(null),toggleMenu(!1)}),$(document).on("click","tbody tr.file a.preview",function(e){if(e.preventDefault(),$(e.target).is("a")){var t=$(e.target).closest("table").find("tr.file:visible").filter(function(e,t){return $(t).find("a.preview").length>0}).index($(e.target).closest("tr.file"));loadGallery(-1!==t?t:0)}})),$(document).on("click","body > div.menu #copy",function(e){var t,n;copyTextToClipboard((t=window.location.href,n=[],$("tr.file td:first-child a:visible").each(function(e,t){var i=$(t).text().split(".").pop().toLowerCase().trim();n.includes(i)||n.push(i)}),'wget -r -np -nH -nd -e robots=off --accept "'.concat(n.join(","),'" "').concat(t,'"'))),toggleMenu(!1)}),$(document).on("click","table th span[sortable]",function(e){var t=$(e.currentTarget).parents("th"),n=t.index(),i=$(e.currentTarget).is("th")?e.currentTarget:t[0],r=$(i).parents("table").eq(0),o={directories:r.find("tbody tr.directory").toArray(),files:r.find("tbody tr.file").toArray()},a=config.sorting.hasOwnProperty("sort_by")&&(2===n||3===n);0!==config.sorting.types&&2!==config.sorting.types||a||o.directories.sort(comparer($(i).index())),0!==config.sorting.types&&1!==config.sorting.types||o.files.sort(comparer($(i).index())),i.asc=!i.asc,$("body > table span.sort-indicator").removeClass("up down"),t.find("> span.sort-indicator").addClass(i.asc?"down":"up").show(),Cookies.set("ei-sort_ascending",i.asc?1:0,{sameSite:"lax"}),Cookies.set("ei-sort_row",n,{sameSite:"lax"}),i.asc||(0!==config.sorting.types&&2!==config.sorting.types||a||(o.directories=o.directories.reverse()),0!==config.sorting.types&&1!==config.sorting.types||(o.files=o.files.reverse())),Object.keys(o).forEach(function(e){return o[e].forEach(function(e){return r.append(e)})}),lister.refresh=!0,lister.selected=null,$("tbody tr.last").removeClass("last")});var applyFilter=function(e){lister.refresh=!0;var t={reset:""===e,shown:{directories:0,files:0},hidden:{directories:0,files:0},size:0};$("body > table tr.file, body > table tr.directory").each(function(n,i){if(i=$(i),t.reset)return i.css("display",""),!0;var r=i.hasClass("file"),o=i.find("td:eq(0)").attr("data-raw").match(new RegExp(e,"i"));if(i.css("display",o?"":"none"),o&&r){var a=i.find("td:eq(2)").attr("data-raw");isNaN(a)||(t.size=t.size+parseInt(a))}o?r?t.shown.files++:t.shown.directories++:r?t.hidden.files++:t.hidden.directories++});var n={container:$("body > div.top-bar")};["size","files","directories"].forEach(function(e){return n[e]=n.container.find('[data-count="'.concat(e,'"]'))}),lister.defaults.hasOwnProperty("top_values")||(lister.defaults.top_values={size:n.size.text(),files:n.files.text(),directories:n.directories.text()}),n.size.text(t.reset?lister.defaults.top_values.size:getReadableSize(t.size)),n.files.text(t.reset?lister.defaults.top_values.files:"".concat(t.shown.files," file").concat(1===t.shown.files?"":"s")),n.directories.text(t.reset?lister.defaults.top_values.directories:"".concat(t.shown.directories," ").concat(1===t.shown.directories?"directory":"directories"));var i=$("body > div.menu > #gallery"),r=$("body > table tr.file:visible a.preview").length;!t.reset&&0===r&&i.length>0?"none"!==i.css("display")&&i.css("display","none"):(r>0||t.reset)&&i.length>0&&"none"===i.css("display")&&i.css("display","block")},toggleFilter=function(){var e=$(".filter-container"),t=e.find('input[type="text"]');e.is(":visible")?e.hide():(t.val(""),applyFilter(""),e.show()),t.focus()},hideOverlays=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=0;[{e:$(".filter-container"),func:toggleFilter},{e:$("body > div.menu"),func:toggleMenu}].forEach(function(e){e.e.length>0&&e.e.is(":visible")&&(e.func(),t++)}),e(t>0)},bind=function(){$(document).off("keydown").on("keydown",function(e){if(e.shiftKey&&70===e.keyCode)e.preventDefault(),toggleFilter();else if(27===e.keyCode)hideOverlays(function(t){!0===t&&e.preventDefault()});else if(71===e.keyCode&&!0===config.gallery.enabled){var t=$(".filter-container");!1!==t.is(":visible")&&t.find('input[type="text"]').is(":focus")||(loadGallery(null),toggleMenu(!1))}})},loadGallery=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(config.debug&&console.log("loadGallery",e),!config.gallery.enabled)return!1;if(lister.gallery&&!1!==lister.gallery){var t=lister.refresh?getTableItems():null;return(null===t||0!==t.length)&&(lister.gallery.show(!0,null===e?lister.gallery.data.selected.index:e,t),void(lister.refresh&&(lister.refresh=!1)))}var n=null;try{n=JSON.parse(Cookies.get("ei-gallery_list-state").toLowerCase())}catch(e){Cookies.set("ei-gallery_list-state",1,{sameSite:"lax"})}lister.gallery=new $.fn.gallery(getTableItems(),{start:null===e?0:e,filter:!1,console:config.debug,fade:config.gallery.fade,mobile:config.mobile,reverse_options:config.gallery.reverse_options,scroll_interval:config.gallery.scroll_interval,show_list:null==n||!!n}),!1!==lister.gallery&&$(lister.gallery).on("unbound",function(e,t){return bind()})},debounce=function(e){var t;return function(n){t&&clearTimeout(t),t=setTimeout(e,100,n)}},setSorting=function(){if(config.hasOwnProperty("sorting")&&config.sorting.enabled&&(0===config.sorting.types||1===config.sorting.types)){var e="asc"===config.sorting.order,t=null;switch(config.sorting.sort_by){case"name":t=0;break;case"modified":t=1;break;case"size":t=2;break;case"type":t=3;break;default:t=null}if(null!==t){var n=$("table th span[sortable]").eq(t).parents("th");n.length>0&&(n[0].asc=e,n.find("> span.sort-indicator").addClass(e?"down":"up").fadeIn(350))}}},createMenu=function(){var e=$("<div/>",{class:"menu"}).appendTo($("body")),t=[{text:"Filter",id:"filter"},{text:"Copy wget",id:"copy"}];return!0===config.gallery.enabled&&$("a.preview").length>0&&t.unshift({text:"Gallery",id:"gallery"}),t.forEach(function(t){$("<div/>",{id:t.id,text:t.text,class:"ns"}).appendTo(e)}),e},setDates=function(){var e=(new Date).getTimezoneOffset(),t=Cookies.get("ei-client_timezone_offset");null!=t&&t==e||(Cookies.set("ei-client_timezone_offset",e,{sameSite:"lax"}),function(e){$("tbody tr.directory > td:nth-child(2), tbody tr.file > td:nth-child(2)").each(function(t,n){if((n=$(n))[0].hasAttribute("data-raw")){var i=_slicedToArray((c=n.attr("data-raw"),d=function(e){return e<10?"0"+e:e},f=new Date(1e3*c),["".concat(d(f.getDate()),"/").concat(d(f.getMonth()+1),"/").concat(f.getFullYear().toString().substring(2)),"".concat(d(f.getHours()),":").concat(d(f.getMinutes()))]),2),r=i[0],o=i[1],a=e>0?-Math.abs(e):Math.abs(e);a/=60;var l=$("<span/>"),s=function(e){if(0===e)return"Now";if(e<0)return!1;for(var t={year:31556926,month:2629743,week:604800,day:86e3,hour:3600,minute:60,second:1},n=Object.keys(t),i=n.length-1,r=!1,o=0;o<n.length;o++){var a=n[o];if(!(e<=t[a])){var l=i>=o+1?n[o+1]:null,s=Math.floor(e/t[a]),c=l?Math.floor((e-s*t[a])/t[l]):0;r="".concat(s," ").concat(a).concat(1==s?"":"s")+(c>0?" and ".concat(c," ").concat(l).concat(1==c?"":"s"):"")+" ago";break}}return r}(config.timestamp-parseInt(n.attr("data-raw")));s&&l.attr("title","".concat(s," (UTC").concat((a>0?"+":"")+a,")")),l.html(r).append($("<span/>",{"data-view":"desktop",text:" "+o})),n.html(l)}var c,d,f})}(e))};setSorting(),config.debug&&console.log("sorting",config.sorting),window.addEventListener("resize",debounce(function(e){config.mobile=Modernizr.mq("(max-width: 640px)")})),document.addEventListener("DOMContentloaded",function(e){config.debug&&console.log("DOMContentloaded")}),$(document).ready(function(){if(bind(),setDates(),$('.filter-container > input[type="text"]').val(""),config.mobile=Modernizr.mq("(max-width: 640px)"),createMenu().css({top:$("body > div.top-bar").outerHeight()+"px",visibility:"unset",display:"none"}),!1===config.mobile&&!0===config.preview.enabled){var e=new $.fn.imagePreview({elements:["a.preview","div.preview"],hoverDelay:config.preview.hover_delay,windowMargin:config.preview.window_margin,staticPreview:config.preview.static,extensions:{images:config.extensions.image,videos:config.extensions.video}});!0===config.preview.cursor_indicator&&($(e).on("load",function(e,t){config.debug&&console.log("load",t)}),$(e).on("loadChange",function(e,t){$("body > table tr.file a.preview").css("cursor",t?"progress":"pointer")}))}});